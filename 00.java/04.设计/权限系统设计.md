# ACL 权限模型

## 1 简介

在 OA 系统中，接触了 ACL (Access control list) 模型的权限设计。ACL 是一种面向资源的访问控制模型。ACL 实体模型的核心在于用户可以直接和权限挂钩，权限模型包括：资源标识、用户标识、授权状态。

## 2 ACL

ACL 的原理为：每一项资源，都配有一个列表，这个列表记录的就是哪些用户可以对这项资源进行增加、检索、更新和删除操作。当用户方位这项资源时，会首先检查这个列表中是否有关于当前用户的访问权限，从而确定当前用户是否可执行相应的操作。总的来说，ACL是一种面向资源的访问控制模型，它的机制是围绕资源展开的。

### 2.1 优点

1. ACL 权限模型原理简单，直接将权限赋给用户，便于理解和操作。
2. 可以满足个性化的需求，即为系统中的用户单独分配权限。

### 2.2 缺点

1. 由于单独维护每个用户的访问权限列表，管理者工作量大，所以需要解决复用性的问题。

### 2.3 改进

ACL 不仅记录用户-资源-操作表，还记录用户组-资源-操作表，用于记录用户或者用户组对资源拥有的权限。改进之后的权限模型包括：资源标识、主体标识、主体类型（用户或用户组的状态）、授权状态。

## 3 RBAC 权限模型

RBAC Role-Based Access Control 基于角色的访问控制。RBAC 认为权限的过程可以抽象为：判断 【WHO 对 what 是否可以进行 how 的访问操作】：

who: 权限的拥有者或者主体 （如 Principal、 User、Group、Role、Actor）等。
what: 权限针对的对象或者资源 （Resource、Class）。
How: 具体的权限（Privilege，正向授权或者负向授权）。

RBAC 的核心思想就是将访问权限与角色相关联，通过给用户分配适合的角色，让用户与访问权限相联系。角色是根据组织内为完成各种任务需要而设置的，根据用户在组织中的职权和责任来设定他们的角色，用户可以在角色间进行转换，系统可以添加、删除角色，还可以对角色的权限进行添加、删除。这样通过应用 RBAC 可将安全性放在一个接近组织结构的自然层面上进行管理。

权限被赋予角色而不是用户，当一个角色被指定给一个用户时，此用户就有该角色所包含的权限。一个用户拥有若干角色，一个角色拥有若干权限，这就构成“用户-角色-权限”的授权模型。

在 RBAC 之中，用户和角色是多对多的关系，角色与权限也是多对多的关系。

RBAC 引入了角色的概念，目的是为了隔离用户与权限，角色作为一个用户与权限的代理层，解耦了权限和用户的关系，所有的授权应当给角色而不是用户。基于角色的访问控制方法（RBAC）的显著两大特征是：

1. 由于角色、权限之间的变化比角色/用户关系之间的变化相对要慢得多，减小了授权管理的复杂性，降低管理成本。

2. 灵活地支持企业地安全策略，并对企业地变化有很大地伸缩性。

### 3.1 优点

- RBAC 是把用户按角色进行归类，通过用户地角色来确定用户能否针对某项资源进行某项操作。相对于ACL最大地优势是它简化了用户与权限地管理，通过对用户进行分类，使得角色与权限关联起来。而用户与权限变成了间接关联，从而解耦。

- 通过对角色设置权限，可一次性对角色下地所有用户设置权限。在角色组中增删单个成员，也不会对角色组整体产生影响。

### 3.2 缺点

- 由于权限是以角色为载体分配的，因此无法对某一角色下地个别用户需要进行地特别权限定制，只能再重新创建角色。即不可对角色组下地单个成员进行个性化权限设置。

- RBAC 模型只给角色赋予了权限，没有提供这些权限地操作顺序控制机制，这一缺陷使得 RBAC 模型很难应用关于那些要求有严格操作顺序地实体系统。例如，在购物控制系统中要求系统对购买步骤地控制，在客户未付款之前不应让他把商品拿走。RBAC 模型要求把这种控制机制放到权限模型中预设好。

### 3.3 改进

原来地模型关系为 用户-角色-权限，为了解决个性化地问题，可在此基础上，增加用户-权限地关联关系，除了可以给角色授权外，还可以给用户直接授权。这样一来，用户拥有的所有权限，就是角色与用户权限之和。

## 4 DAC

自主访问控制模型：规定资源可以被哪些主体进行哪些操作，同时，主体可以将资源、操作地权限授予其他主体。

在 ACL 地基础上，DAC 模型将授权的权利下放，允许拥有权限的用户，可以自主的把权限授予其他用户。

DAC 的应用场景：常见于文件系统，LINUX、UNIX、WINDOWNT 版本的操作系统都提供 DAC 的支持。在实现上先对于用户鉴权，然后根据控制列表决定用户能否访问资源。用户控制权限的修改通常由特权用户或者管理组实现。

### 4.1 缺点

- DAC 最大的缺陷是对权限的控制过于分散，比如无法简单地将一组文件设置统一的权限并开放给指定的一群用户。

- 主体的权限太大，授权其他用户时，无意间可能造成泄露信息。

## 5 MAC 权限模型

MAC 是强制访问控制模型，是为了弥补 DAC 权限控制过于分散的问题而诞生的。主体被赋予一定的安全级别，客体被赋予一定的安全级别，主体能否访问客体由双方的关系安全级别决定，这个判断通常由系统硬性限制。

当一个操作，同时满足 a 与 b 时，允许操作。

- a 规定资源可以被哪些类别的主体进行哪些操作
- b 规定主体可以对哪些等级的资源做哪些操作

MAC 是在 ACL 的基础上的另一种实现，强调安全性。MAC 会在系统中，对资源与主体，都划分类别与等级。MAC 非常适合机密构成或者其他等级观念强烈的行业，但对于类似商业服务系统，则因为不够灵活而不能适用。

MAC 要继续用 DAC 的模型，但要对用户进行等级划分，比如 一级、二级、三级。对对象资源也要做划分，比如机密、秘密和最高机密。用户访问资源的时候，根据用户等级与资源访问级别来判断，比如一级用户只能访问机密文件，如果访问的是最高机密文件，系统就会拒绝。这一系列的规则是优先于 DAC 的，如果 MAC 与 DAC 混用，要先校验 MAC 再校验 DAC。


### 5.1 优点

实现资源与主体的双重验证，确保资源的交叉隔离，提高安全性。

### 5.2 缺点

只适用于特定的安全性高要求较高的场景。过重强调保密性，使得管理不够灵活。

### 5.3 改进

在实现上，MAC 和 DAC 通常为每个用户赋予客体的访问权限的规则集，然后在为每个用户组分配权限。

## 6 ABAC

ABAC 是基于属性的访问控制权限模型：规定哪些属性的主体可以对哪些属性资源在哪些属性的环境下进行哪些操作属性。

ABAC 其中的属性就与主体、资源、环境相关的所有信息:

- 主体的属性：指的是与主体相关的所有信息，包括主体的年龄、性别、职位等。

- 资源的属性：指的是与资源相关的所有信息，包括资源的创建时间、创建位置、密级等。

- 环境的属性：指的是客观情况的属性，比如当前的时间、当前的位置、当前的场景（普通状态、紧急状态）

- 操作属性：指的是可进行的全部操作，例如增删改查。

当企业中参与权限管理的用户数量很多、或者角色数量很多时，传统的RBAC模型会显露出一些缺点，比如容易遗漏需要参与到权限管理的部分用户，并且容易受到“角色数量爆炸”的影响。RBAC虽然是目前最普遍的权限控制模型。但是某些情况下，RBAC是无法满足并且也实现不了的。比如业务员1和业务员2都属于业务员角色，都有查看客户订单的权限。当有一个需求，要求业务员1只能查看北京地区的客户的订单，业务员2只能查看上海的客户的订单。这单单使用RBAC是无法实现。借助RBAC，可行的做法是，分地区创建角色，然后程序中根据角色做数据的过滤，这种做法缺点是，每次需求变更的时候可能都需要修改代码。

此时需要新的权限管理方法来控制对企业的访问，允许特定用户在特定场景下拥有特定权限。通常考虑的第一种解决方案是基于属性的访问控制（ABAC），会在系统中设置好基于用户属性、资源属性、环境属性和操作权限的预定义规则，当某个用户进入到系统中时，会获取用户和当前场景的属性，基于这些属性，自动为该用户分配权限。所以说，ABAC中可以完全自动化——可根据所获取到的属性进行自动判定和授权，而不需要使用管理员手动设置授权。

传统的 RBAC 与 ACL 等访问控制机制，可以认为是 ABAC 的子集。对于 RBAC来说，访问机制的实现只是基于主体的属性“角色”而已，ACL 只是基于主体的属性是“单个用户”。而ABAC 基于更多的属性，能做到更细粒度的授权管理。例如，ABAC权限模型中通过众多属性来决策实现，只有姓张的工程师在处理项目A时才能访问某个资源，其中“姓张、工程师、项目A”都是决策所依据的属性。因此，ABAC模型不需要关注特定的用户好角色，只需要对提炼出的各种“属性”进行授权规则设置，管理对象为属性和权限。

ABAC对用户本身的属性进行标识，通过属性标识来判断用户权限。这样的设计使得ABAC非常灵活，可扩展性也很高。ABAC一般来说，都是搭配着ACL或RBAC一起使用，不会单独成体系。以上述业务员查看订单为例，说明ABAC的一种实现方式：

在RBAC的基础上，扩展一个实体规则。其中，订单就是实体，地区是实体的属性。
然后针对实体（订单）的属性（地区）设置一系列规则。规则存储格式可以是json、SQL语句等等，能解析即可。规则为：业务员1只能查看北京地区的客户的订单，业务员2只能查看上海的客户的订单。
保存规则，包括规则内容(即json、SQL语句等)、规则实体(即订单)、适用操作（即增删改查等）。
将创建好实体的规则与角色做关联，也就是将北京地区的规则关联到北京地区业务员角色上，上海地区的规则关联到上海地区业务员角色上。
后端做权限校验的时候，还是先按RBAC模型的控制方式进行校验(是否具备订单查看权限)，然后根据当前操作对象(也就是实体)，取出用户所属角色关联的对应实体的规则。然后解析规则，动态拼接Sql语句。
以上只是针对地区属性实现了动态权限控制。实际业务中，要控制可能更多，比如字段权限、数据范围等等。要满足这些复杂的控制，需要制定一套完整的规则，以及针对规则编写相应的解析程序。

优点：

可适用于用户数量和角色数量很多的权限管理场景，在设置好预定义规则之后，系统可对用户进行自动授权，不需要使用管理员手动设置授权。
缺点：

当采用ABAC模型时，随着属性数量的不断增加，定义与单个用户相关联的每个属性的复杂性也随之增加，从而增加了管理整个企业的访问管理的难度。需要IT团队部署和维护。
实现成本高：ABAC非常的灵活，但是实现比较困难。这其中涉及到逻辑的动态执行，数据动态过滤等，更加具体就是动态拼接SQL语句。
基于属性的访问控制模型(ABAC)被认为是访问控制模型的未来。但并不是当前权限管理场景下的最优方案。

## 7 TBAC 访问控制模型

TBAC 是基于任务的访问控制模型。它从工作流中的任务角度建模，可以依据任务和任务状态的不同，对权限进行动态管理。适用于工作流、分布式处理和十五管理系统中的决策定制与权限管理。

ACL、RBAC、DAC、MAC 都是从系统的角度（控制环境是静态的）出发保护资源。其访问控制的原理可以简单的描述为：如果主体对某客体由访问操作请求，而且主体拥有操作权限，则提供访问操作。

工作流是为完成某一目标而由多个相关的任务（即活动构成的业务流程。工作流所关注的问题是处理过程的自动化，对任何其他资源进行协调管理，从而完成整个工作流程。当数据在工作流中流动时，执行操作的用户在改变，用户的权限也在改变，这与数据处理的前后节点环境相关。采用传统的控制访问技术难以做到这点。）

TBAC 可以对工作流的各个任务节点进行动态权限管理。在 TBAC 中，主体（即角色相等）的访问权限并不是静止不变的，而是随着工作流的任务流转而不断发生变化。在工作流中，每一步对数据的处理都与以前的处理相关，相应的访问控制也是这样。

TBAC 是一种与前后任务节点相关的访问控制模型。

- TBAC 不仅能够对不同的工作流实行不同的访问策略，也能对统一工作流的不同任务节点实行不同的访问控制策略。

- 因为任务都有时效性（即工作流流转到下个任务节点时，当前任务节点时效结束），所以 TBAC 中，用户对于授权的使用也是有时效性的。

### 7.1 优点

在业务流、工作流等特定情况下，可以动态管理权限，比传统的静态权限模型更贴合场景。

### 7.2 缺点

实现成本高，需要IT团队开发和维护。工作流的任务节点数量和形式可能不固定，各节点的流转要求也不尽相同，每次进行调整时都要对权限模型进行修改。只有在结构稳定工作流中，才可稳定运行。

## 8 EBAC

EBAC是基于受控实体的访问控制技术。对各种客观存在的和逻辑定义的企业信息资源（即主体拥有访问权限的客体），定义为受控实体。

传统的访问控制策略 DAC和 MAC存在安全缺陷和应用复杂性等问题，当前企业应用系统中采用较多的是RBAC。在访问控制对象和操作比较明确的系统中，RBAC 能够提供一种灵活、有效的用户行为能力的组织机制。但 RBAC 是一种被动的、提前授权的访问控制技术，主体可以无限制使用其拥有的客体及客体资源的访问权限，不能依据操作环境进行访问主体和客体的动态变更。

TBAC通过对工作流中任务步骤的动态授权，可以清晰地表达复杂工作流的控制机制，主体权限的时效性也因任务的时效性得以解决，在一定程度上能够实现授权管理的自动化。但是TBAC强调工作流各任务的原子性，受限于工作流和任务的数量，造成权限配置的复杂性。其次，主体访问权限的动态性和频繁改变的特性，增加了系统安全控制实现的难度，也给整个系统的运行效率造成影响。

EBAC模型以受控实体为访问客体，并以其为中心实现安全控制机制。一方面，用户通过对受控实体的管理，间接获取访问权限；另一方面，受控实体可动态地对用户权限集和属性集的访问进行自主控制。EBAC 是一个随受控实体业务调度变化的动态访问控制模型。EBAC 充分利用企业资源类属的有限性和依据管理策略组织的特性，以受控实体为访问客体，并由其自主控制访问主体对访问客体权限集和属性集的访问能力，采用静态权限分配和动态权限授予相结合的方式。