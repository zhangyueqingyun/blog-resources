# windows 中的进程通信
## 文件映射（Memory-Mapped Files）
可以让进程把文件内容当做进程地址区间中的一块内存一样对待。进程不必使用文件 I / O 操作，只需要简单的指针操作即可读取和修改文件的内容。读取或修改文件的内容，实现了对文件中数据的共享。

应用程序有三种方法来使多个进程共享一个文件映射对象。
- 继承：第一个进程建立文件映射对象，它的子进程继承该对象的句柄。
- 命名文件映射：第一个进程在建立文件映射对象时，给该对象制定一个名字（可与文件名不同）。第二个进程可通过这个名字打开此文件映射的对象。另外，第一个进程可以通过其他 IPC 机制把名字传递给第二个进程。
- 句柄复制：第一个进程建立文件映射对象，然后通过其他 IPC 集中制把对象句柄传递给第二个进程，第二个进程复制该句柄取得对该文件映射对象的访问权限。

文件映射是在多个进程间共享数据非常有效的方法，有较好的安全性。但文件映射只能用于本地及其的进程之间，不能用于网络中，开发者还必须控制进程间的同步。
## 共享内存 （Shared Memory）
WIN 32 API 中的共享内存实际上就是文件映射的一种特殊情况。进程在创建文件映射对象时用 0XFFFFFFFF 来代替文件句柄，就表示了对应的文件映射对象是从操作系统页面文件访问的内存，其他进程打开文件映射对象就可以访问该内存块。由于共享内存是用文件映射实现的，所以它也具有较好的安全性。
## Pipe 
管道是一种具有两个端点的通信通道，有一端句柄的进程可以有另一端句柄的进程通信。管道可以是单向的，一端只读，另一端只写。也可以是双向的，可堵可写。

匿名管道是在父进程和子进程之间，或同一父进程的两个子进程之间传输数据的无名字的单向管道，通常由父进程创建管道，然后由要通信的子进程继承通道的读端点或写端点句柄，然后实现通信。父进程还可以建立两个或多个继承匿名管道读写句柄的子进程。这些子进程可以使用管道进行直接通信，不需要通过父进程。
## Named Pipe 
服务器进程和一个或多个进程之间通信的单向或者双向管道，不同于匿名管道的是命名管道可以再不相关的进程之间和不同计算机之间使用，服务器建立命名管道时给它制定一个名字，任何进程都可以通过该名字打开管道的另一端，根据给定的权限和服务器进行通信。
## 邮件槽（Maileslots）
邮件槽提供进程间单向通信的能力，任何进程都能建立邮件槽称为邮件槽服务器。其它进程，称为邮件槽客户，可以通过邮件槽的名字给邮件槽服务器进程发送消息。发送的消息一直被放在邮件槽中，直到服务器进程读取。一个进程既可以是邮件槽服务器也可以是邮件槽客户，因此可建立多个邮件槽实现进程间的双向通信。

通过邮件槽可以给本地计算机上的邮件槽、其他计算机上的邮件槽或指定网络区域中的所有计算机上有同样名字的邮件槽发送消息，光波通信的消息长度不能超过 400 字节，非广播消息的长度则收邮件槽服务器指定的最大消息长度的限制。

邮件槽与命名管道相似，不过它传输数据是通过不可靠的数据报如 udp 完成的，一旦网络错误则不能保证消息正确地接收。而命名管道传输数据则是建立在可靠连接的基础上。不过邮件槽有简单化的编程接口，和给指定网络区域内所有计算机广播消息的能力。所以邮件槽不失为应用程序发送和接收消息的另一种选择。
## 剪切板（clipped board）
剪切板是一组用于创术数据的函数和消息，为 windows 应用程序之间进行数据共享提供了中介。 windows 已建立的剪切、赋值、复制、粘贴为不同应用程序之间共享不同格式数据提供了一条捷径。当用户在应用程序中执行剪切或复制操作室，应用程序把选取的数据通过一种或多种格式放在剪切板上，然后任何其他应用程序都可以拾取数据。

剪切板是一个非常松散的交换媒介，可支持任何数据格式，每一种格式由一组无符号证书标识，对标准剪切板的格式，该值是 Win102 api 定义的常量。对非标准格式可以使用 Register Clipboard format 函数注册为新的剪切板格式，利用剪切板进行交换的数据只需要在数据格式上一致或都可以转换为某种格式就行。
## 动态数据交换 （dynamical data exchange)
使用共享内存在应用程序之间进行数据交换的一种进程间通信形式。应用程序可以使用 DDE 进行一次数据传输，也可以当出现新数据时，通过发送更新值在应用程序见动态交换数据。

DDE 和剪贴板一样及支持标准数据格式（如文本、位图等），又可以支持自己定义的数据格式。但他们的传输机制不同，一个明显的区别是剪切板操作几乎总是对用户指定操作进行一次性应答。

DDE 有三种数据交换的方式：
- 冷链 数据交换是一次性数据传输
- 温链 数据交换时服务器通知用户，用户必须请求新数据
- 热恋 数据交换时服务器自动给客户发送数据

DDE  交换可以发生在单机或者网络中不同计算机的应用程序之间，开发者还可以定义定制的 DDE 数据格式进行应用程序之间特别多 IPC，它有更紧密耦合的通信要求。大多数是基于 Windows 的应用程序都支持 DDE。
## 对象连接与嵌入 
应用程序利用对象的连接与嵌入技术管理复合文档。OLE 提供使某些应用程序更容易调用其他应用程序进行数据编辑的服务。
## 动态连接库（DDL）
win 32 的动态链接库中的全局数据，可以被调用 DLL 的所有进程共享。
## 远程过程调用
Win32 提供的远程过程调用（RPC）使应用程序可以使用远程调用函数，这使得在网络上使用 RPC 进行进程通信就像函数调用那样简单。 RPC 可以在本机或者网络中使用。

Win32 提供的 RPC 遵从 OSF-DCE 标准。
## NetBios 函数
用于处理低级网络控制，这主要是为 IBM NetBios 系统编写与 Windows 的接口，除非那些有特殊低级网络功能要求的应用程序，其它应用程序最好不要使用 NetBios 进行进程间通信。
## Sockets 
Windows Sockets 规范是以 U.C Berkeley 大学 BSD UNIX 中流行的 Socket 接口为范例定义的一套 Windows 下的网络编程接口。除了 Berkeley Socket 原有的库函数以外，还扩展了一组针对 Windows 的函数，使程序员可以充分利用 Windows 的消息机制编程。

通过 Sockets 实现进程间通信的网络应用越来越多，主要因为 Sockets 的跨平台性要比其他 ipc 机制好很多。 另外 WinSock 2.0 不仅支持 TCP/IP 协议，而且还支持其他协议（如 IPX）。 Sockets 的唯一缺点是它支持的是底层通信操作，这使得在淡季中进行简单的数据传输不方便。
## WM_COPYDATA 消息
WM_COPYDATA 是一种强大却鲜为人知的消息。当一个应用向另外一个应用传递数据时，发送方只需要调用 SendMessage 函数，参数是目的窗口的句柄、传递数据的起始地址、 WM_COPYDATA 消息，接收方只需要处理其他消息处理 WM_COPY DATA 消息，这样收发双方就实现了数据共享。

WM_COPYDATA 是一种非常简单的方法，它在底层实际上是通过文件映射来实现的。它的缺点是灵活性不够高，并且它只能用于 Windows 平台。